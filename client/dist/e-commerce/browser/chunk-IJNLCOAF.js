import{a as ee}from"./chunk-XYAPIZ46.js";import{G as K,Ga as T,J as Q,K as X,M as C,R as Y,S as p,a as N,aa as Z,ba as g,c as L,f as J,h as V,j as W,ja as y,k as B,ka as v,m as S,o as G,p as O,tb as D,ub as P,vb as I,z as H}from"./chunk-EW7DCEDO.js";import{a as f,b as M,e as z}from"./chunk-FDERIQAA.js";function w(e){e||(g(w),e=p(v));let t=new L(r=>e.onDestroy(r.next.bind(r)));return r=>r.pipe(Q(t))}function $(e,t){!t?.injector&&g($);let r=t?.injector??p(y),n=new V(1),o=I(()=>{let b;try{b=e()}catch(d){P(()=>n.error(d));return}P(()=>n.next(b))},{injector:r,manualCleanup:!0});return r.get(v).onDestroy(()=>{o.destroy(),n.complete()}),n.asObservable()}function E(e,t,r){!t&&g(e);let n=t??p(y);return r?Z(n,r):n}function h(e,...t){let[r,n,o,b,d]=ie(t);if(r){let u=null;return o instanceof v?u=o:u=E(h,o).get(v),r.pipe(w(u)).subscribe(c=>{let a=()=>{e.update(i=>{if(!R(i))return n?.(i,c)||c;if(!R(c)){let j=n?n(i,c):c;return R(j)?f(f({},i),j):j}return f(f({},i),n?.(i,c)||c)})};b?P(a):a()})}if(d){let u=o instanceof y?E(h,o):void 0;return I(()=>{e.update(c=>R(c)?f(f({},c),d()):d())},{allowSignalWrites:!0,injector:u})}return{with(...u){if(!this.subscription)this.subscription=new N;else if(this.subscription.closed)return console.info("[ngxtension connect] ConnectedSignal has been closed."),this;return this.subscription.add(h(e,...u,o,b)),this},subscription:null}}function ie(e){return e.length>3?[e[0],e[1],e[2],e[3],null]:e.length===3?typeof e[2]=="boolean"?S(e[0])?[e[0],null,e[1],e[2],null]:[null,null,e[1],e[2],e[0]]:[e[0],e[1],e[2],!1,null]:e.length===2?typeof e[1]=="boolean"?[null,null,e[0],e[1],null]:typeof e[1]=="function"?[e[0],e[1],null,!1,null]:[e[0],null,e[1],!1,null]:S(e[0])?[e[0],null,null,!1,null]:typeof e[0]=="function"?[null,null,null,!1,e[0]]:[null,null,e[0],!1,null]}function R(e){return typeof e=="object"&&e!==void 0&&e!==null&&!Array.isArray(e)}function ne(e){let t=p(v),r=p(y),{initialState:n,sources:o=[],lazySources:b=[],actionSources:d={},selectors:u=()=>({}),effects:c=()=>({})}=e,a=T(n),i=a.asReadonly(),j=$(a),F=!1,q=[],k=i;te(a,o);for(let[s,l]of Object.entries(d))if(S(l))re(i,j,s,t,l,q);else{let m=new J,_=l(i,m).pipe(K());h(a,_),re(i,j,s,t,m,q,_)}for(let s in n)Object.defineProperty(i,s,{value:D(()=>i()[s])});for(let[s,l]of Object.entries(u(k)))Object.defineProperty(i,s,{value:D(l)});for(let[s,l]of Object.entries(c(k)))console.warn("The 'effects' configuration in signalSlice is deprecated. Please use standard signal effects outside of signalSlice instead."),Object.defineProperty(k,s,{value:I(m=>{let A=l();A&&m(()=>A())})});t.onDestroy(()=>{q.forEach(s=>s.complete())});let U=()=>{F||(F=!0,te(a,b,r,!0))};return new Proxy(k,{get(s,l,m){return U(),Reflect.get(s,l,m)},apply(s,l,m){return U(),Reflect.apply(s,l,m)}})}function te(e,t,r,n=!1){for(let o of t)S(o)?h(e,o,r,n):h(e,o(e.asReadonly()),r,n)}function re(e,t,r,n,o,b,d){Object.defineProperties(e,{[r]:{value:u=>S(u)?new Promise((c,a)=>{u.pipe(w(n)).subscribe({next:i=>{o.next(i)},error:i=>{o.error(i),a(i)},complete:()=>{o.complete(),c(e())}})}):(d&&d.pipe(w(n)).subscribe(),new Promise(c=>{t.pipe(H(1)).subscribe(a=>{c(a)}),o.next(u)}))},[`${r}$`]:{value:o.asObservable()}}),b.push(o)}var x=class e{constructor(t){this.productsService=t}userCartCount(){return z(this,null,function*(){let t=localStorage.getItem("authToken");t&&(yield G(this.productsService.getCart(t)))})}loadProducts(){let t=localStorage.getItem("authToken");return t?W(this.productsService.getCart(t).pipe(X(r=>this.saveProducts(r)))):B([])}saveProducts(t){localStorage.setItem("products",JSON.stringify(t))}static \u0275fac=function(r){return new(r||e)(Y(ee))};static \u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"})};var oe=class e{_storageService=p(x);initialState={products:[],loaded:!1};loadProducts$=this._storageService.loadProducts().pipe(O(t=>({products:t,loaded:!0})));state=ne({initialState:this.initialState,sources:[this.loadProducts$],selectors:t=>({count:()=>(Array.isArray(t().products)?t().products:[]).reduce((r,n)=>r+n.quantity,0),price:()=>(Array.isArray(t().products)?t().products:[]).reduce((r,n)=>r+n.product.price*n.quantity,0)}),actionSources:{add:(t,r)=>r.pipe(O(n=>this.add(t,n))),remove:(t,r)=>r.pipe(O(n=>this.remove(t,n))),update:(t,r)=>r.pipe(O(n=>this.update(t,n)))},effects:t=>({load:()=>{t().loaded&&this._storageService.saveProducts(t().products)}})});add(t,r){let n=Array.isArray(t().products)?t().products.find(o=>o.product._id===r.product._id):void 0;return n?(n.quantity+=1,{product:[...t().products]}):{products:[...t().products,M(f({},r),{quantity:1})]}}remove(t,r){return{products:t().products.filter(n=>n.product._id!==r)}}update(t,r){return{products:t().products.map(o=>o.product._id===r.product._id?M(f({},o),{quantity:r.quantity}):o)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"})};export{ne as a,oe as b};

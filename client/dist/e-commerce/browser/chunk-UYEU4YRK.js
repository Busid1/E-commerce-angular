import{Ab as I,Cb as z,F as Q,Ga as T,I as V,L as C,R as p,a as B,aa as X,ba as g,c as L,f as J,h as W,j as G,ja as y,k as H,ka as h,m as v,o as O,y as K,yb as D,zb as k}from"./chunk-VABZW2L3.js";import{a as f,b as M,f as N}from"./chunk-TRNF7YA4.js";function w(e){e||(g(w),e=p(h));let t=new L(r=>e.onDestroy(r.next.bind(r)));return r=>r.pipe(V(t))}function E(e,t){!t?.injector&&g(E);let r=t?.injector??p(y),n=new W(1),o=I(()=>{let b;try{b=e()}catch(d){k(()=>n.error(d));return}k(()=>n.next(b))},{injector:r,manualCleanup:!0});return r.get(h).onDestroy(()=>{o.destroy(),n.complete()}),n.asObservable()}function U(e,t,r){!t&&g(e);let n=t??p(y);return r?X(n,r):n}function S(e,...t){let[r,n,o,b,d]=re(t);if(r){let u=null;return o instanceof h?u=o:u=U(S,o).get(h),r.pipe(w(u)).subscribe(s=>{let a=()=>{e.update(i=>{if(!R(i))return n?.(i,s)||s;if(!R(s)){let j=n?n(i,s):s;return R(j)?f(f({},i),j):j}return f(f({},i),n?.(i,s)||s)})};b?k(a):a()})}if(d){let u=o instanceof y?U(S,o):void 0;return I(()=>{e.update(s=>R(s)?f(f({},s),d()):d())},{allowSignalWrites:!0,injector:u})}return{with(...u){if(!this.subscription)this.subscription=new B;else if(this.subscription.closed)return console.info("[ngxtension connect] ConnectedSignal has been closed."),this;return this.subscription.add(S(e,...u,o,b)),this},subscription:null}}function re(e){return e.length>3?[e[0],e[1],e[2],e[3],null]:e.length===3?typeof e[2]=="boolean"?v(e[0])?[e[0],null,e[1],e[2],null]:[null,null,e[1],e[2],e[0]]:[e[0],e[1],e[2],!1,null]:e.length===2?typeof e[1]=="boolean"?[null,null,e[0],e[1],null]:typeof e[1]=="function"?[e[0],e[1],null,!1,null]:[e[0],null,e[1],!1,null]:v(e[0])?[e[0],null,null,!1,null]:typeof e[0]=="function"?[null,null,null,!1,e[0]]:[null,null,e[0],!1,null]}function R(e){return typeof e=="object"&&e!==void 0&&e!==null&&!Array.isArray(e)}function ee(e){let t=p(h),r=p(y),{initialState:n,sources:o=[],lazySources:b=[],actionSources:d={},selectors:u=()=>({}),effects:s=()=>({})}=e,a=T(n),i=a.asReadonly(),j=E(a),A=!1,q=[],P=i;Y(a,o);for(let[c,l]of Object.entries(d))if(v(l))Z(i,j,c,t,l,q);else{let m=new J,_=l(i,m).pipe(Q());S(a,_),Z(i,j,c,t,m,q,_)}for(let c in n)Object.defineProperty(i,c,{value:D(()=>i()[c])});for(let[c,l]of Object.entries(u(P)))Object.defineProperty(i,c,{value:D(l)});for(let[c,l]of Object.entries(s(P)))console.warn("The 'effects' configuration in signalSlice is deprecated. Please use standard signal effects outside of signalSlice instead."),Object.defineProperty(P,c,{value:I(m=>{let $=l();$&&m(()=>$())})});t.onDestroy(()=>{q.forEach(c=>c.complete())});let F=()=>{A||(A=!0,Y(a,b,r,!0))};return new Proxy(P,{get(c,l,m){return F(),Reflect.get(c,l,m)},apply(c,l,m){return F(),Reflect.apply(c,l,m)}})}function Y(e,t,r,n=!1){for(let o of t)v(o)?S(e,o,r,n):S(e,o(e.asReadonly()),r,n)}function Z(e,t,r,n,o,b,d){Object.defineProperties(e,{[r]:{value:u=>v(u)?new Promise((s,a)=>{u.pipe(w(n)).subscribe({next:i=>{o.next(i)},error:i=>{o.error(i),a(i)},complete:()=>{o.complete(),s(e())}})}):(d&&d.pipe(w(n)).subscribe(),new Promise(s=>{t.pipe(K(1)).subscribe(a=>{s(a)}),o.next(u)}))},[`${r}$`]:{value:o.asObservable()}}),b.push(o)}var x=class e{userCartCount(){return N(this,null,function*(){let t=localStorage.getItem("authToken");yield z.get("http://localhost:2000/user/cart",{headers:{Authorization:`Bearer ${t}`}})})}loadProducts(){let t=localStorage.getItem("authToken");return t?G(z.get("http://localhost:2000/user/cart",{headers:{Authorization:`Bearer ${t}`}}).then(r=>(this.saveProducts(r.data),r.data))):H([])}saveProducts(t){localStorage.setItem("products",JSON.stringify(t))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"})};var te=class e{_storageService=p(x);initialState={products:[],loaded:!1};loadProducts$=this._storageService.loadProducts().pipe(O(t=>({products:t,loaded:!0})));state=ee({initialState:this.initialState,sources:[this.loadProducts$],selectors:t=>({count:()=>t().products.reduce((r,n)=>r+n.quantity,0),price:()=>t().products.reduce((r,n)=>r+n.product.price*n.quantity,0)}),actionSources:{add:(t,r)=>r.pipe(O(n=>this.add(t,n))),remove:(t,r)=>r.pipe(O(n=>this.remove(t,n))),update:(t,r)=>r.pipe(O(n=>this.update(t,n)))},effects:t=>({load:()=>{t().loaded&&this._storageService.saveProducts(t().products)}})});add(t,r){let n=t().products.find(o=>o.product._id===r.product._id);return n?(n.quantity+=1,{product:[...t().products]}):{products:[...t().products,M(f({},r),{quantity:1})]}}remove(t,r){return{products:t().products.filter(n=>n.product._id!==r)}}update(t,r){return{products:t().products.map(o=>o.product._id===r.product._id?M(f({},o),{quantity:r.quantity}):o)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"})};export{ee as a,te as b};

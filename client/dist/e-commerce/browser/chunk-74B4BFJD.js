import{b as T}from"./chunk-UYEU4YRK.js";import{k as _}from"./chunk-34B33TYW.js";import{Aa as s,Cb as k,Qa as E,R as w,Ra as b,Sa as o,Ta as a,Ua as S,V as y,Ya as C,_a as I,cb as l,db as u,eb as P,gb as L,jb as m,kb as f}from"./chunk-VABZW2L3.js";import{f as x}from"./chunk-TRNF7YA4.js";var q="https://js.stripe.com/v3",B=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,j="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",D=function(){for(var e=document.querySelectorAll('script[src^="'.concat(q,'"]')),t=0;t<e.length;t++){var n=e[t];if(B.test(n.src))return n}return null},A=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(q).concat(t);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(n),n},G=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"5.5.0",startTime:t})},c=null,v=null,h=null,J=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},O=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},R=function(e){return c!==null?c:(c=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(j),window.Stripe){t(window.Stripe);return}try{var r=D();if(r&&e)console.warn(j);else if(!r)r=A(e);else if(r&&h!==null&&v!==null){var d;r.removeEventListener("load",h),r.removeEventListener("error",v),(d=r.parentNode)===null||d===void 0||d.removeChild(r),r=A(e)}h=O(t,n),v=J(n),r.addEventListener("load",h),r.addEventListener("error",v)}catch(N){n(N);return}}),c.catch(function(t){return c=null,Promise.reject(t)}))},X=function(e,t,n){if(e===null)return null;var r=e.apply(void 0,t);return G(r,n),r},p,F=!1,M=function(){return p||(p=R(null).catch(function(e){return p=null,Promise.reject(e)}),p)};Promise.resolve().then(function(){return M()}).catch(function(i){F||console.warn(i)});var W=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];F=!0;var r=Date.now();return M().then(function(d){return X(d,t,r)})};var z=(i,e)=>e==null||e.product==null?null:e.product._id;function Q(i,e){if(i&1&&(o(0,"li",15)(1,"span",18),l(2),a(),o(3,"span",19),l(4),a(),o(5,"span"),l(6,"x"),a(),o(7,"span",19),l(8),m(9,"currency"),a()()),i&2){let t=e.$implicit;s(),I("title",t.product.title),s(),u(t.product.title),s(2),u(t.quantity),s(4),u(f(9,4,t.product.price))}}var g=class i{state=w(T).state;stripe=null;elements=null;card=null;ngOnInit(){return x(this,null,function*(){this.stripe=yield W("pk_test_51PJC6AJeIz2JibtC32QxNpQqNVtPQ06sAJOfLd7CvEkux2WEKekyYZmCaT2gHCLGJSiXIxmWCU6iMwXeZstZAeWG00utnMfqhT"),this.elements=this.stripe?.elements()||null,this.card=this.elements?.create("card",{style:{base:{color:"#32325d",fontSize:"16px","::placeholder":{color:"#aab7c4"}}}})||null,this.card?.mount("#card-element")})}handleSubmit(e){return x(this,null,function*(){if(e.preventDefault(),!this.stripe||!this.card)return;let{error:t,paymentMethod:n}=yield this.stripe.createPaymentMethod({type:"card",card:this.card});if(t)console.error("Stripe Error:",t);else try{let r=localStorage.getItem("authToken"),{id:d}=n;if(!r)throw new Error("Authentication token not found");yield k.post("http://localhost:2000/user/checkout",{id:d,amount:Number(this.state.price().toFixed(2))*100,products:this.state.products()},{headers:{Authorization:`Bearer ${r}`}})}catch(r){console.log("Request error:",r)}})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=y({type:i,selectors:[["app-checkout"]],standalone:!0,features:[L],decls:28,vars:6,consts:[[1,"font-[sans-serif]","bg-slate-900","p-4","h-screen","pt-32"],[1,"md:max-w-5xl","max-w-xl","mx-auto"],[1,"grid","md:grid-cols-2","lg:grid-cols-3","gap-8"],[1,"lg:col-span-2","max-md:order-1"],[1,"text-3xl","font-extrabold","text-slate-100"],[1,"text-slate-100","text-sm","mt-4"],[1,"mt-8","max-w-lg"],[1,"grid","gap-4"],["type","text","placeholder","Cardholder's Name",1,"px-4","py-3.5","bg-gray-100","text-gray-800","w-full","text-sm","border","rounded-md","focus:border-blue-500","outline-none"],[1,"w-full","flex","flex-col","gap-4",3,"submit"],["id","card-element",1,"p-3","bg-gray-100","rounded"],["type","submit",1,"bg-green-500","text-white","py-3.5","rounded-md","hover:bg-green-600"],[1,"bg-slate-100","p-6","rounded-md"],[1,"text-3xl","font-bold","text-gray-800"],[1,"text-gray-800","mt-8","space-y-3"],[1,"flex","flex-wrap","gap-4","text-lg","overflow-hidden","whitespace-nowrap","text-ellipsis"],[1,"flex","flex-wrap","gap-4","text-lg","font-bold","border-t-2","pt-4"],[1,"ml-auto"],[1,"flex-1","truncate",3,"title"],[1,"ml-auto","font-bold"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),l(5,"Pay products"),a(),o(6,"p",5),l(7,"Complete your transaction swiftly and securely with our easy-to-use payment process."),a(),o(8,"form",6)(9,"div",7)(10,"div"),S(11,"input",8),a(),o(12,"form",9),C("submit",function(d){return n.handleSubmit(d)}),S(13,"div",10),o(14,"button",11),l(15," Pay "),a()()()()(),o(16,"div",12)(17,"h2",13),l(18),m(19,"currency"),a(),o(20,"ul",14),E(21,Q,10,6,"li",15,z),o(23,"li",16),l(24,"Total "),o(25,"span",17),l(26),m(27,"currency"),a()()()()()()()),t&2&&(s(18),u(f(19,2,n.state.price())),s(3),b(n.state.products()),s(5),P(" ",f(27,4,n.state.price())," "))},dependencies:[_]})};export{g as default};
